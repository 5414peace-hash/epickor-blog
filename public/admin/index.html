<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>EpicKor Blog Admin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  
  <!-- Point to the Decap CMS config file -->
  <link href="config.yml" type="text/yaml" rel="cms-config-url" />
  
  <!-- Custom Styles -->
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    
    /* Custom branding */
    .nc-app-header {
      background-color: #2C2416 !important;
    }
    
    .nc-app-header-button {
      color: #FAF6F0 !important;
    }
    
    /* Loading indicator */
    #loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-size: 1.5rem;
      color: #2C2416;
    }
  </style>
</head>
<body>
  <!-- Loading indicator -->
  <div id="loading">Loading EpicKor Blog Admin...</div>
  
  <!-- Include the script that builds the page and powers Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <!-- Custom initialization after CMS loads -->
  <script>
    window.addEventListener('load', function() {
      // Hide loading indicator
      const loadingEl = document.getElementById('loading');
      if (loadingEl) {
        loadingEl.style.display = 'none';
      }
      
      // Check if CMS is available
      if (typeof CMS === 'undefined') {
        console.error('Decap CMS failed to load');
        document.body.innerHTML = '<div style="padding: 2rem; text-align: center;"><h1>Error</h1><p>Failed to load Decap CMS. Please refresh the page.</p></div>';
        return;
      }
      
      // Register custom preview styles
      CMS.registerPreviewStyle("/admin/preview.css");
      
      // Add bulk update link
      CMS.registerAdditionalLink({
        id: 'bulk-update',
        title: 'Bulk Update Posts',
        data: '/admin/bulk-update.html',
        options: {
          icon: 'upload'
        }
      });
      
      console.log('EpicKor Blog Admin loaded successfully');
      
      // Load custom widgets after CMS initializes
      const customScript = document.createElement('script');
      customScript.src = '/admin/custom-widgets.js';
      customScript.onload = function() {
        console.log('Custom widgets loaded');
      };
      customScript.onerror = function() {
        console.error('Failed to load custom widgets');
      };
      document.body.appendChild(customScript);
    });
  </script>
</body>
</html>
